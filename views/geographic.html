
{% extends "../views/base.html" %}
    {% block title %} Dashboard {% end %}
    {% block main_content %}


    <div class="main-panel">
        <nav class="navbar navbar-default navbar-fixed">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example-2">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">Dashboard</a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-left">
                        <li>
                            <a href="/" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-dashboard"></i>
								<p class="hidden-lg hidden-md">Dashboard</p>
                            </a>
                        </li>
                    </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <p>
										Account
										<b class="caret"></b>
									</p>
                              </a>
                              <ul class="dropdown-menu">
                                <li><a href="#">Account Settings</a></li>
                                <li><a href="#">Logout</a></li>
                              </ul>
                        </li>
						<li class="separator hidden-lg hidden-md"></li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="content">
            <div class="container-fluid">
                <div class="loader center-block"></div>
                <div class="all-data">
                    <div class="dropdown timespan">
                        <button class="btn btn-primary btn-lg dropdown-toggle" type="button" data-toggle="dropdown"><span id="timespan">All Time</span>
                        <span class="caret"></span></button>
                        <ul class="dropdown-menu">
                            <li><a href="#" id="day">Past Day</a></li>
                            <li><a href="#" id="week">Past Week</a></li>
                            <li><a href="#" id="month">Past Month</a></li>
                            <li><a href="#" id="all">All Time</a></li>
                        </ul>
                    </div>
                <div class="row card-container">

                </div>
                </div>
            </div>
        </div>

        <!--footer-->

        <footer class="footer">
            <p class="copyright pull-right">
                &copy; <script>document.write(new Date().getFullYear())</script> DisarrayTech
            </p>
        </footer>

    </div>
    {% end %}
    {% block page_script %}

    <script type="text/javascript" src="/static/js/jquery.vmap.min.js"></script>
    <script type="text/javascript" src="/static/js/jquery.vmap.world.js" charset="utf-8"></script>

    <script>
        let request_url = '/api/geographic?timespan=';
        let card_container = $('.card-container');

        function request_data(url) {
            $.get(url, function (data) {
                show_data();
                data = JSON.parse(data);

                if(data.length > 0) {

                   card_container.append(`
                            <div class="col-md-12">
                                <div id="vmap" style="width: 100%; height: 600px;"></div>
                            </div>
                   `);
                   formatted_data = {};
                   for(let i = 0 ; i < data.length; ++i){
                       formatted_data[data[i].c_code] = data[i].count;
                   }


                    $('#vmap').vectorMap(
                    {
                        backgroundColor: null,
                        color: '#ffffff',
                        hoverOpacity: 0.7,
                        selectedColor: '#666666',
                        enableZoom: false,
                        showTooltip: true,
                        values: formatted_data,
                        scaleColors: ['#FFEBEE', '#B71C1C'],
                        normalizeFunction: 'polynomial',
                        hoverColor: false,
                        map : 'world_en'
                    });




                let table = `<div class="col-md-7 col-md-offset-2">
                                    <table class="table">
                                      <thead>
                                        <tr>
                                          <th>Country</th>
                                          <th>Hits</th>
                                        </tr>
                                      </thead>
                                      <tbody class="stats-table">
                                      </tbody>
                                    </table>
                                    </div>`
                card_container.append(table);
                let stats_table = $('.stats-table');
                for(let i = 0; i < data.length; ++i) {
                       stats_table.append(`
                        <tr>
                            <td>${data[i]['country']}</td>
                            <td>${numeral(data[i]['count']).format('0,0')}</td>
                        </tr>
                       `)
                   }


                }

                else {
                    card_container.append(generate_card6md('No Data', 'No data exists for this time period'));
                }
            });
        }

        $(document).ready(function(){
            request_data(request_url + 'all');
        });
    </script>
    {% end %}

